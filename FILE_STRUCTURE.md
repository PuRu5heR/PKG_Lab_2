# Детальное описание структур файлов

## 1. JPEG формат

**Полная структура JPEG файла:**

```
[SOI] [APP0] [APP1] [APPn...] [DQT] [SOF0] [DHT] [DRI] [SOS] [Сжатые данные] [EOI]
```

**Детальное описание всех сегментов:**

**SOI (Start of Image) - Начало изображения**
- Маркер: `FF D8`
- Длина: 2 байта (без данных)
- Назначение: Начало JPEG файла

**APP0 (Application Segment 0) - JFIF метаданные**
- Маркер: `FF E0`
- Длина: 2 байта + данные
- Структура данных:
  ```
  [Длина:2] [Идентификатор:5] [Версия:2] [Единицы:1] [XDensity:2] [YDensity:2] [XThumbnail:1] [YThumbnail:1] [Данные thumbnail]
  ```
- Идентификатор: "JFIF\0"
- Версия: (например, 1.1)
- Единицы: 0=нет, 1=dpi, 2=dpcm

**APP1 (Application Segment 1) - EXIF метаданные**
- Маркер: `FF E1`
- Длина: 2 байта + данные
- Идентификатор: "Exif\0\0"
- Содержит метаданные EXIF (дата, камера, настройки и т.д.)

**APPn (Application Segments 2-15)**
- Маркеры: `FF E2` - `FF EF`
- Произвольные данные приложений

**DQT (Define Quantization Table) - Таблицы квантования**
- Маркер: `FF DB`
- Структура:
  ```
  [Длина:2] [QT_info:1] [QT_data:64]
  ```
- QT_info: бит 0-3 - номер таблицы, бит 4-7 - точность (0=8 бит, 1=16 бит)

**SOF0 (Start of Frame - Baseline DCT)**
- Маркер: `FF C0`
- Структура:
  ```
  [Длина:2] [Точность:1] [Высота:2] [Ширина:2] [Компоненты:1] [Описания компонентов...]
  ```
- Описание компонента: `[ID:1] [Отсчеты:1] [Таблица квантования:1]`

**SOF2 (Start of Frame - Progressive DCT)**
- Маркер: `FF C2`
- Аналогично SOF0, но для прогрессивного JPEG

**DHT (Define Huffman Table) - Таблицы Хаффмана**
- Маркер: `FF C4`
- Структура:
  ```
  [Длина:2] [HT_info:1] [Коды длин:16] [Символы:переменная]
  ```
- HT_info: бит 0-3 - номер таблицы, бит 4 - тип (0=DC, 1=AC)

**DRI (Define Restart Interval) - Интервал перезапуска**
- Маркер: `FF DD`
- Структура: `[Длина:4] [Интервал:2]`

**SOS (Start of Scan) - Начало сканирования**
- Маркер: `FF DA`
- Начало сжатых данных изображения

**EOI (End of Image) - Конец изображения**
- Маркер: `FF D9`
- Конец JPEG файла

## 2. PNG формат

**Полная структура PNG файла:**

```
[Сигнатура] [IHDR] [tEXt] [zTXt] [iTXt] [gAMA] [cHRM] [sRGB] [PLTE] [tRNS] [IDAT] [IEND]
```

**Сигнатура PNG:**
```
89 50 4E 47 0D 0A 1A 0A
```

**Структура чанка:**
```
[Длина:4] [Тип:4] [Данные:Длина] [CRC:4]
```

**Детальное описание всех чанков:**

**IHDR (Image Header) - Заголовок изображения**
- Обязательный первый чанк
- Структура данных:
  ```
  [Ширина:4] [Высота:4] [Глубина:1] [ТипЦвета:1] [Сжатие:1] [Фильтр:1] [Чередование:1]
  ```
- Типы цвета:
    - 0: Grayscale
    - 2: Truecolor (RGB)
    - 3: Indexed
    - 4: Grayscale with alpha
    - 6: Truecolor with alpha

**tEXt (Textual Data) - Текстовые данные**
- Содержит пары ключ-значение
- Формат: `[Ключ]00[Значение]`

**zTXt (Compressed Text) - Сжатые текстовые данные**
- Аналогично tEXt, но данные сжаты

**iTXt (International Text) - Интернациональный текст**
- Поддержка Unicode
- Структура: `[Ключ]00[Сжатие]00[Язык]00[Перевод]00[Текст]`

**gAMA (Gamma) - Гамма-коррекция**
- Содержит значение гаммы × 100000

**cHRM (Chromaticities) - Цветовые характеристики**
- Белая точка и RGB примиaries

**sRGB (Standard RGB) - Цветовое пространство sRGB**
- Указывает использование sRGB

**PLTE (Palette) - Палитра**
- Только для indexed color
- Структура: `[R][G][B]` для каждой записи

**tRNS (Transparency) - Прозрачность**
- Для indexed: альфа для каждой палитры
- Для grayscale: значение прозрачности
- Для truecolor: RGB прозрачного цвета

**IDAT (Image Data) - Данные изображения**
- Может быть несколько чанков
- Данные сжаты методом Deflate

**IEND (Image End) - Конец изображения**
- Обязательный последний чанк
- Без данных

## 3. GIF формат

**Полная структура GIF файла:**

```
[Сигнатура] [Логический экран] [Глобальная палитра] [Расширения] [Изображения] [Trailer]
```

**Сигнатура и версия:**
- "GIF87a" или "GIF89a"

**Логический экран (Logical Screen Descriptor):**
```
[Ширина:2] [Высота:2] [Пакованный:1] [ЦветФона:1] [Соотношение:1]
```

**Пакованный байт логического экрана:**
- Бит 7: Наличие глобальной палитры
- Бит 6-4: Разрешение цвета
- Бит 3: Флаг сортировки палитры
- Бит 2-0: Размер глобальной палитры

**Глобальная палитра:**
- Только если установлен бит 7 в пакованном байте
- Размер: 3 × 2^(размер+1) байт

**Расширения:**
- **Application Extension** (NETSCAPE): для анимации
- **Graphic Control Extension**: параметры отображения
- **Comment Extension**: комментарии
- **Plain Text Extension**: текст

**Блок изображения:**
```
[Разделитель:1] [Левый:2] [Верхний:2] [Ширина:2] [Высота:2] [Пакованный:1] [Локальная палитра] [Данные]
```

**Trailer:**
- `3B` - конец файла

## 4. TIFF формат

**Структура TIFF файла:**

```
[Порядок байт] [Magic] [Offset IFD] [IFD] [Данные]
```

**Заголовок TIFF:**
- Порядок байт: "II" (little endian) или "MM" (big endian)
- Magic number: 42
- Offset первого IFD

**IFD (Image File Directory) структура:**
```
[Количество записей:2] [Записи:12×N] [Offset следующего IFD:4]
```

**Запись IFD:**
```
[Tag:2] [Type:2] [Count:4] [Value/Offset:4]
```

**Основные теги TIFF:**
- 256 (0x100): ImageWidth
- 257 (0x101): ImageHeight
- 258 (0x102): BitsPerSample
- 259 (0x103): Compression
- 262 (0x106): PhotometricInterpretation
- 282 (0x11A): XResolution
- 283 (0x11B): YResolution
- 296 (0x128): ResolutionUnit

## 5. BMP формат

**Структура BMP файла:**

```
[Заголовок файла] [Заголовок информации] [Палитра] [Данные изображения]
```

**Заголовок файла (BITMAPFILEHEADER):**
```
[Сигнатура:2] [Размер файла:4] [Резерв:2] [Резерв:2] [Offset данных:4]
```

**Заголовок информации (BITMAPINFOHEADER):**
```
[Размер заголовка:4] [Ширина:4] [Высота:4] [Плоскости:2] [Бит на пиксель:2] [Сжатие:4] [Размер изображения:4] [XРазрешение:4] [YРазрешение:4] [Цвета:4] [Важные цвета:4]
```

**Типы сжатия BMP:**
- 0: BI_RGB - без сжатия
- 1: BI_RLE8 - RLE 8 бит
- 2: BI_RLE4 - RLE 4 бита
- 3: BI_BITFIELDS - битовые маски

## 6. PCX формат

**Структура PCX файла:**

```
[Заголовок] [Данные изображения] [Палитра]
```

**Заголовок PCX:**
```
[Производитель:1] [Версия:1] [Кодирование:1] [Бит на пиксель:1] [Xmin:2] [Ymin:2] [Xmax:2] [Ymax:2] [HRes:2] [VRes:2] [Палитра:48] [Резерв:1] [Плоскости:1] [Байт на линию:2] [Инфо палитры:2] [Резерв:58]
```

**Версии PCX:**
- 0: Версия 2.5
- 2: Версия 2.8 с палитрой
- 3: Версия 2.8 без палитры
- 4: Paintbrush для Windows
- 5: Версия 3.0 и выше